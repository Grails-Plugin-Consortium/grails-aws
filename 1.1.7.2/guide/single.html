<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Grails AWS Plugin 1.1.7.2 - Reference Documentation</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Style" charset="utf-8"/>
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    </head>
    <body class="body">
        <div id="header">
            <div class="images"><br/><br/>
                <a href="http://grails.org" target="_blank"><img alt="The Grails Framework" src="../img/grails.png" border="0"/></a>
                <span style="right:30px; top:20px; position:absolute;">
                    <a href="../index.html" target="_top">Frames</a> | <a href="index.html" target="_top">No Frames</a><br/><br/>
                    <a href="http://springsource.com" target="_blank"><img alt="SpringSource - A Division of VMware" src="../img/springsource-logo.png" border="0"/></a>
                </span>
            </div>
            <div class="message">aws</div>
            <h1>Grails AWS Plugin - Reference Documentation</h1>
            <p><strong>Authors:</strong> Lucas Teixeira</p>
            <p><strong>Version:</strong> 1.1.7.2</p>
            <em></em>
        </div>

        <div id="toc">
            <h2>Table of Contents</h2>
            <div class="tocItem" style="margin-left:0px"><a href="#1 Introduction to Grails AWS Plugin">1 Introduction to Grails AWS Plugin</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.1 Installing Grails AWS Plugin">1.1 Installing Grails AWS Plugin</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.2 Getting the source code">1.2 Getting the source code</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.3 Configuring the plugin in your application">1.3 Configuring the plugin in your application</a></div><div class="tocItem" style="margin-left:20px"><a href="#1.3.1 Setting AWS Credentials">1.3.1 Setting AWS Credentials</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.4 Gant scripts">1.4 Gant scripts</a></div><div class="tocItem" style="margin-left:0px"><a href="#2 Amazon Simple Storage Service (AWS S3)">2 Amazon Simple Storage Service (AWS S3)</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.1 Specific configuration for S3">2.1 Specific configuration for S3</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.2 Uploading files">2.2 Uploading files</a></div><div class="tocItem" style="margin-left:20px"><a href="#2.2.1 Setting file virual path">2.2.1 Setting file virual path</a></div><div class="tocItem" style="margin-left:20px"><a href="#2.2.2 Overwriting AWS credentials">2.2.2 Overwriting AWS credentials</a></div><div class="tocItem" style="margin-left:20px"><a href="#2.2.3 Overwriting bucket to file upload">2.2.3 Overwriting bucket to file upload</a></div><div class="tocItem" style="margin-left:20px"><a href="#2.2.4 ACL (file permission)">2.2.4 ACL (file permission)</a></div><div class="tocItem" style="margin-left:20px"><a href="#2.2.5 RRS - Reduced Redundancy Storage">2.2.5 RRS - Reduced Redundancy Storage</a></div><div class="tocItem" style="margin-left:20px"><a href="#2.2.6 Setting File Metadata">2.2.6 Setting File Metadata</a></div><div class="tocItem" style="margin-left:20px"><a href="#2.2.7 Creating public URLs for private files">2.2.7 Creating public URLs for private files</a></div><div class="tocItem" style="margin-left:20px"><a href="#2.2.8 Creating torrent for S3 hosted files">2.2.8 Creating torrent for S3 hosted files</a></div><div class="tocItem" style="margin-left:10px"><a href="#2.3 Deleting files">2.3 Deleting files</a></div><div class="tocItem" style="margin-left:0px"><a href="#3 Amazon Simple Email Service (AWS SES)">3 Amazon Simple Email Service (AWS SES)</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.1 SES Gant scripts">3.1 SES Gant scripts</a></div><div class="tocItem" style="margin-left:20px"><a href="#3.1.1 Operation VerifyEmail">3.1.1 Operation VerifyEmail</a></div><div class="tocItem" style="margin-left:20px"><a href="#3.1.2 Operation ListVerifiedEmails">3.1.2 Operation ListVerifiedEmails</a></div><div class="tocItem" style="margin-left:20px"><a href="#3.1.3 Operation GetSendQuota">3.1.3 Operation GetSendQuota</a></div><div class="tocItem" style="margin-left:20px"><a href="#3.1.4 Operation GetSendStatistics">3.1.4 Operation GetSendStatistics</a></div><div class="tocItem" style="margin-left:20px"><a href="#3.1.5 Testing your verified email">3.1.5 Testing your verified email</a></div><div class="tocItem" style="margin-left:10px"><a href="#3.2 Sending mail from your application">3.2 Sending mail from your application</a></div><div class="tocItem" style="margin-left:20px"><a href="#3.2.1 Configuring the SES options">3.2.1 Configuring the SES options</a></div><div class="tocItem" style="margin-left:20px"><a href="#3.2.2 Sending text emails">3.2.2 Sending text emails</a></div><div class="tocItem" style="margin-left:20px"><a href="#3.2.3 Sending HTML emails">3.2.3 Sending HTML emails</a></div><div class="tocItem" style="margin-left:0px"><a href="#4 FAQ">4 FAQ</a></div><div class="tocItem" style="margin-left:0px"><a href="#5 Roadmap">5 Roadmap</a></div><div class="tocItem" style="margin-left:0px"><a href="#6 Changelog">6 Changelog</a></div><div class="tocItem" style="margin-left:0px"><a href="#7 Contributions and reporting bugs">7 Contributions and reporting bugs</a></div><div class="tocItem" style="margin-left:0px"><a href="#8 Contact">8 Contact</a></div>
        </div>
        <div id="content">
            <h1><a name="1 Introduction to Grails AWS Plugin">1 Introduction to Grails AWS Plugin</a></h1>Grails AWS plugin intends to provide most of any other reason, an EASY WAY to access and use AWS services.<p class="paragraph"/>Not all services are included in the plugin, you can check this guide to see what you can do and how.
If you want to contribute with another service that is not implemented yet, check Section <strong class="bold">"Contributions ad Reporting Bugs"</strong> of this guide.<h2><a name="1.1 Installing Grails AWS Plugin">1.1 Installing Grails AWS Plugin</a></h2>As other grails plugins you should install using <strong class="bold">install-plugin</strong> command<p class="paragraph"/><div class="code"><pre>grails intall&#45;plugin aws</pre></div><h2><a name="1.2 Getting the source code">1.2 Getting the source code</a></h2>If you want to get the source code for this plugin, check Blanq Github's repository at <a href="http://github.com/blanq/grails-aws" target="blank">http://github.com/blanq/grails-aws</a><h2><a name="1.3 Configuring the plugin in your application">1.3 Configuring the plugin in your application</a></h2>You'll have to configure the plugin in Config.groovy to set AWS credentials and other properties specifically to each AWS service you may use.<h2><a name="1.3.1 Setting AWS Credentials">1.3.1 Setting AWS Credentials</a></h2><h3>Setting AWS Credentials</h3><p class="paragraph"/>You can set your access-key and secret-key in two different manners as below<p class="paragraph"/><h4>Property-file credentials configuration</h4><p class="paragraph"/>As recommended by Amazon, you can use a .properties file to handle your secret and access keys for this plugin.<p class="paragraph"/>You'll have to create some properties file with the content as show below:<p class="paragraph"/><div class="code"><pre>accessKey = your&#45;access&#45;key
secretKey = your&#45;secret&#45;key</pre></div><p class="paragraph"/>And then, you will have to tell your application in Config.groovy to read this property file:<p class="paragraph"/><div class="code"><pre>grails &#123;
   plugin &#123;
      aws &#123;
         credentials &#123;
            properties = <span class="java&#45;quote">"/my/path/to/AwsCredentials.properties"</span>
         &#125;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>Plain-text credentials configuration</h4><p class="paragraph"/>If you don't have access to the filesystem in someway, or prefer to set the access and secret key directly in Config.groovy, you can do it this way:<p class="paragraph"/><div class="code"><pre>grails &#123;
   plugin &#123;
      aws &#123;
         credentials &#123;
            accessKey = <span class="java&#45;quote">"your&#45;access&#45;key"</span>
            secretKey = <span class="java&#45;quote">"your&#45;secret&#45;key"</span>
         &#125;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="warning">
Remember, if you set a properties file, it will take priority over this way.
</blockquote><h2><a name="1.4 Gant scripts">1.4 Gant scripts</a></h2>Grails AWS Plugin brings some scripts to use in your app, all scripts names follow this rule:<p class="paragraph"/><div class="code"><pre>aws&#45;&#91;service&#93;&#45;&#91;operation&#93;</pre></div><p class="paragraph"/>So, all scripts are prefixed with 'aws', followed by its service code, and then the operation name, almost always the same operation name in the corresponding WSDL. For example, to connect with SES and check your sending email statistics (GetSendStatistics operation), you'll have to execute:<p class="paragraph"/><div class="code"><pre>grails aws&#45;ses&#45;get&#45;send&#45;statistics</pre></div><p class="paragraph"/>All information are printed in your screen, and when you need to interact with parameters, the script will prompt you.<h1><a name="2 Amazon Simple Storage Service (AWS S3)">2 Amazon Simple Storage Service (AWS S3)</a></h1><h2><a name="2.1 Specific configuration for S3">2.1 Specific configuration for S3</a></h2>In your config.groovy, inside <strong class="bold">grails.plugin.aws</strong> closure, you can set some extra configurations for S3 usage.
This properties will be used when no respective config is defined when uploading file.<p class="paragraph"/>For example, you can define a default bucket for file uploads. Everytime you attemp to upload a file without explicitly setting the bucket name, this default will be used.<p class="paragraph"/>Check now, all default config possibilities you can set.<p class="paragraph"/><h3>Bucket name</h3><p class="paragraph"/>To set a default bucket, that will be used to all file upload use the config below<p class="paragraph"/><div class="code"><pre>grails &#123;
   plugin &#123;
      aws &#123;
         s3 &#123;
            bucket = <span class="java&#45;quote">"grails&#45;plugin&#45;test"</span>
         &#125;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/>During the first upload on this bucket, it will be created if does not exist.<p class="paragraph"/><h3>ACL (file permission)</h3><p class="paragraph"/>The permissions that will be granted on this file, you can use:
<ul class="star">
<li><strong class="bold">public:</strong> Allow public access to everyone that attemps to read this file</li>
<li><strong class="bold">private:</strong> Sets private access to this file, only your account will read/write on it</li>
<li><strong class="bold">public_read_write:</strong> This will make this file wide open to any AWS account, read and write</li>
<li><strong class="bold">authenticated_read:</strong> Using this acl string, only logged AWS accounts will have permissions to read the file</li>
</ul><p class="paragraph"/>To configure public access as default to all file uploads, use this:<p class="paragraph"/><div class="code"><pre>grails &#123;
   plugin &#123;
      aws &#123;
         s3 &#123;
            acl = <span class="java&#45;quote">"<span class="java&#45;keyword">public</span>"</span>
         &#125;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/>If you like to set private access to your files, you should config this way:<p class="paragraph"/><div class="code"><pre>grails &#123;
   plugin &#123;
      aws &#123;
         s3 &#123;
            acl = <span class="java&#45;quote">"<span class="java&#45;keyword">private</span>"</span>
         &#125;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><h3>RRS - Reduced Redundancy Storage</h3><p class="paragraph"/>RRS stored files provides a cheaper storage with 99.99% durability instead of 99.999999999% as the default provided by AWS S3. More information here: <a href="http://aws.amazon.com/about-aws/whats-new/2010/05/19/announcing-amazon-s3-reduced-redundancy-storage/" target="blank">http://aws.amazon.com/about-aws/whats-new/2010/05/19/announcing-amazon-s3-reduced-redundancy-storage/</a><p class="paragraph"/>This is disabled by default, if you like to set RRS enabled for all uploads, use this config key:<p class="paragraph"/><div class="code"><pre>grails &#123;
   plugin &#123;
      aws &#123;
         s3 &#123;
            rrs = <span class="java&#45;keyword">true</span>
         &#125;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><h2><a name="2.2 Uploading files">2.2 Uploading files</a></h2>The plugin adds support for uploading files to Amazon S3, by adding a s3upload(...) method to <strong class="bold">File</strong> and <strong class="bold">InputStream</strong> classes, so you'll just need to call this method passing a closure with overwritten config options, but if you do not want to overwrite it, just leave this and the plugin will catch from the Config.groovy default options.<p class="paragraph"/><h3>Simple File upload from a File object</h3><p class="paragraph"/><div class="code"><pre>def s3file = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/tmp/test.txt"</span>).s3upload &#123;
    path <span class="java&#45;quote">"folder/to/my/file/"</span>
&#125;</pre></div><p class="paragraph"/>This way your test.txt file will be uploaded to<p class="paragraph"/><div class="code"><pre>&#60;<span class="java&#45;keyword">default</span>&#45;bucket&#62;.s3.amazonaws.com/folder/to/my/file/test.txt</pre></div><p class="paragraph"/>If you want to overwrite config during the file upload, check this guide next section.<p class="paragraph"/><h3>Uploading files directly from its InputStream</h3><p class="paragraph"/>This is useful when you don't have the file stored in your filesystem, and don't want to have.
When user uploads files to your application using a <strong class="bold">multipart/form-data</strong> form, you can upload it directly to s3. Imagine it have an upload form like this:<p class="paragraph"/><div class="code"><pre>&#60;g:uploadForm action=<span class="java&#45;quote">"uploadFromInputStream"</span>&#62;
    &#60;input type=<span class="java&#45;quote">"file"</span> name=<span class="java&#45;quote">"photo"</span>&#62;
    &#60;input type=<span class="java&#45;quote">"submit"</span> value=<span class="java&#45;quote">"upload"</span>&#62;
&#60;/g:uploadForm&#62;</pre></div><p class="paragraph"/>you could have your <strong class="bold">uploadFromInputStream</strong> action implemented this way:<p class="paragraph"/><div class="code"><pre>def file = request.getFile('photo')
def uploadedFile = file.inputStream.s3upload(file.originalFilename, file.size) &#123;
    bucket <span class="java&#45;quote">"file&#45;upload&#45;from&#45;inputstream"</span>
&#125;</pre></div><p class="paragraph"/><blockquote class="warning">
Uploading from InputStream requires 2 extra parameters, the filename and its size.
</blockquote><p class="paragraph"/>Note that when you use <strong class="bold">File</strong>.s3upload you just pass the closure that configures it. When using from one inputStream, you <strong class="bold">SHOULD</strong> have to specify the name that file will have and the file size. The above example show exactly how to do it with the correct info from the uploaded file.<p class="paragraph"/><h3>Storing uploaded information for later use</h3><p class="paragraph"/>If you are uploading some picture to S3, you'll probably need to store information on how to get that file again later.<p class="paragraph"/>The <strong class="bold">s3upload</strong> operation returns an instance of <strong class="bold">grails.plugin.aws.s3.S3File</strong>. As this plugin uses jets3t (<a href="http://jets3t.s3.amazonaws.com/index.html" target="blank">http://jets3t.s3.amazonaws.com/index.html</a>) to handle file upload, the S3File is just a wrapper for a <strong class="bold">delegated</strong> jets3t S3Object instance as you can see below:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> grails.plugin.aws.s3
<span class="java&#45;keyword">import</span> org.jets3t.service.model.S3Object<p class="paragraph"/>class S3File &#123;<p class="paragraph"/>    @Delegate S3Object source<p class="paragraph"/>    <span class="java&#45;keyword">public</span> S3File(S3Object _source) &#123;
        <span class="java&#45;keyword">this</span>.source = _source
    &#125;    
&#125;</pre></div><p class="paragraph"/>So, you can call any S3Object method on S3File instance. S3Object API is available here: <a href="http://jets3t.s3.amazonaws.com/api/org/jets3t/service/model/S3Object.html" target="blank">http://jets3t.s3.amazonaws.com/api/org/jets3t/service/model/S3Object.html</a>, for example, to retrieve the ETag hash for the S3File uploaded you would just call:<p class="paragraph"/><div class="code"><pre>def s3file = &#8230; //upload the file
def etag = s3file.getETag()</pre></div><p class="paragraph"/>The <strong class="bold">S3File</strong> object returned will give all information you'll need. Now, depends on what information you want to store. Follow S3Object docs (link above) and get whatever you want.<p class="paragraph"/>A common approach would be storing the bucket, path and file (key). With these parameters you can rebuild the URL to reach the file, or even delete the file. <h2><a name="2.2.1 Setting file virual path">2.2.1 Setting file virual path</a></h2>S3 does not support paths or buckets inside other buckets, to solve this and keep your files organized, you can use the path method inside the config closure. Doing this, the plugin will set a metadata into this file telling AWS that this file is virtually in a folder that does not exist.<p class="paragraph"/>The effect is exactly like in a regular folder. For example, doing the upload below:<p class="paragraph"/><div class="code"><pre>def uploadedFile = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/tmp/profile&#45;picture.jpg"</span>).s3upload &#123;
    bucket <span class="java&#45;quote">"my&#45;aws&#45;app"</span>
    path <span class="java&#45;quote">"pictures/user/profile/"</span>
&#125;</pre></div><p class="paragraph"/>The file will be stored and available in the following url:<p class="paragraph"/><div class="code"><pre>http://my&#45;aws&#45;app.s3.amazonaws.com/pictures/user/profile/profile&#45;picture.jpg</pre></div><p class="paragraph"/>And using the AWS S3 console, the files will visually be inside folders either.
Some third-party apps is already using this feature to show "folders".<h2><a name="2.2.2 Overwriting AWS credentials">2.2.2 Overwriting AWS credentials</a></h2>Just call the <strong class="bold">credentials</strong> method inside the upload closure, and this credentials will be used (for this upload only). Example:<p class="paragraph"/><div class="code"><pre>def uploadedFile = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/tmp/test.txt"</span>).s3upload &#123;
    credentials <span class="java&#45;quote">"my&#45;other&#45;access&#45;key"</span>, <span class="java&#45;quote">"my&#45;other&#45;secret&#45;key"</span>
&#125;</pre></div>
<h2><a name="2.2.3 Overwriting bucket to file upload">2.2.3 Overwriting bucket to file upload</a></h2>You can call the <strong class="bold">bucket</strong> method and define witch different bucket (from default) will be used. This bucket will be created if does not exist.<p class="paragraph"/><div class="code"><pre>def uploadedFile = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/tmp/test.txt"</span>).s3upload &#123;
    bucket <span class="java&#45;quote">"other&#45;bucket"</span>
&#125;</pre></div><p class="paragraph"/>This file will be uploaded to<p class="paragraph"/><div class="code"><pre>other&#45;bucket.s3.amazonaws.com/test.txt</pre></div><p class="paragraph"/>Remember, when plugin created a non pre-existent bucket, it will be created in the default <strong class="bold">US</strong> region. If you like to set a different location, just pass a second string parameter containing the region string. For example, to set this bucket creation in Europe region:<p class="paragraph"/><div class="code"><pre>def uploadedFile = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/tmp/test.txt"</span>).s3upload &#123;
    bucket <span class="java&#45;quote">"bucket&#45;not&#45;yet&#45;created&#45;in&#45;europe"</span>, <span class="java&#45;quote">"EU"</span>
&#125;</pre></div><h2><a name="2.2.4 ACL (file permission)">2.2.4 ACL (file permission)</a></h2>The permissions that will be granted on this file, you can use the same values shown in "General Plugin Config" topic on this guide.<p class="paragraph"/><div class="code"><pre>def uploadedFile = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/tmp/test.txt"</span>).s3upload &#123;
    acl <span class="java&#45;quote">"<span class="java&#45;keyword">private</span>"</span>
&#125;</pre></div><h2><a name="2.2.5 RRS - Reduced Redundancy Storage">2.2.5 RRS - Reduced Redundancy Storage</a></h2>If some specifically file you like to use a different RRS setting, call the rrs method in the closure, passing true or false, as you wish<p class="paragraph"/><div class="code"><pre>def uploadedFile = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/tmp/test.txt"</span>).s3upload &#123;
    rrs <span class="java&#45;keyword">false</span>
&#125;</pre></div><h2><a name="2.2.6 Setting File Metadata">2.2.6 Setting File Metadata</a></h2>AWS S3 files can store user metadata, doing this is simple as setting a metadata map to file upload<p class="paragraph"/><div class="code"><pre>def uploadedFile = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"/tmp/test.txt"</span>).s3upload &#123;
    metadata &#91;user&#45;id: 123, username: 'johndoe', registered&#45;date: <span class="java&#45;keyword">new</span> Date().format('dd/MM/yyyy')&#93;
&#125;</pre></div><h2><a name="2.2.7 Creating public URLs for private files">2.2.7 Creating public URLs for private files</a></h2>When you upload a file to S3 with a "private" acl, means that the file won't be accessed directly using the URL, but only with your amazon credentials.<p class="paragraph"/>For example:<p class="paragraph"/><div class="code"><pre>def s3file = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"test.txt"</span>).s3upload &#123;
   bucket <span class="java&#45;quote">"secret&#45;files"</span>
   acl <span class="java&#45;quote">"<span class="java&#45;keyword">private</span>"</span>
&#125;</pre></div><p class="paragraph"/>This will make the file above (http://secret-files.s3.amazonaws.com/test.txt) inaccessible using its URL. If you need to allow someone to get the file in a short period of time, you can ask the plugin to generate a public URL for it. The object will remain private, but you can use the returned URL to access the file in a short period of time. For example:<p class="paragraph"/><div class="code"><pre>def s3file = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"test.txt"</span>).s3upload &#123;
   bucket <span class="java&#45;quote">"secret&#45;files"</span>
   acl <span class="java&#45;quote">"<span class="java&#45;keyword">private</span>"</span>
&#125;<p class="paragraph"/>def publicUrl = s3file.publicUrlFor()</pre></div><p class="paragraph"/>So, the value on the <strong class="bold">publicUrl</strong> is the URL for accessing the file. By default the URL will be valid for <strong class="bold">1 hour</strong>. Every requests on it will return the uploaded object. After one hour, next requests on it will return an error: "Access Denied for Object".<p class="paragraph"/><h3>Defining when public URL will expire</h3><p class="paragraph"/>You can set the expires date for the public URL, passing an argument to <strong class="bold">publicUrlFor</strong> method.<p class="paragraph"/><div class="code"><pre>s3file.publicUrlFor(3.hours) //will be available <span class="java&#45;keyword">for</span> 3 hours
s3file.publicUrlFor(10.years) //available <span class="java&#45;keyword">for</span> 10 years
s3file.publicUrlFor(1.second) //you won't get <span class="java&#45;keyword">this</span> one on time</pre></div><p class="paragraph"/>You can any of these methods:<p class="paragraph"/><div class="code"><pre>1.second or 2.seconds 
1.minute or 2.minutes
1.hour or 2.hours
1.day or 2.days
1.month or 2.months
1.year or 2.years</pre></div><p class="paragraph"/>This properties are injected on Integer class, so, enjoy the magic. <h2><a name="2.2.8 Creating torrent for S3 hosted files">2.2.8 Creating torrent for S3 hosted files</a></h2>It is possible to generate torrent URLs for S3 hosted files with the plugin.<p class="paragraph"/>After uploading some file, just call the <strong class="bold">torrent()</strong> method on it and you'll get the torrent URL for it.<p class="paragraph"/><div class="code"><pre>def s3file = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"test.txt"</span>).s3upload &#123;
   bucket <span class="java&#45;quote">"secret&#45;files"</span>
   acl <span class="java&#45;quote">"<span class="java&#45;keyword">private</span>"</span>
&#125;<p class="paragraph"/>def torrentUrl = s3file.torrent()</pre></div><p class="paragraph"/>From the AWS docs:<p class="paragraph"/> <em class="italic"><strong class="bold">There is no extra charge for use of BitTorrent with S3</strong>. Data transfer via the BitTorrent protocol is metered at the same rate as client/server delivery. To be precise, whenever a downloading BitTorrent client requests a “piece” of an object from the S3 “seeder”, charges accrue just as if an anonymous request for that piece had been made using the REST or SOAP protocol. These charges will appear on your S3 bill and usage reports in the same way. <strong class="bold">The difference is that if a lot of clients are requesting the same object simultaneously via BitTorrent, then the amount of data S3 must serve to satisfy those clients will be lower than with client/server delivery</strong>. This is because the BitTorrent clients are simultaneously uploading and downloading amongst themselves. The data transfer savings achieved from use of BitTorrent can vary widely depending on how popular your object is. Less popular objects require heavier use of the “seeder” to serve clients, and thus the difference between BitTorrent distribution costs and client/server distribution costs may be small for such objects. In particular, if only one client is ever downloading a particular object at a time, the cost of BitTorrent delivery will be the same as direct download.</em> <h2><a name="2.3 Deleting files">2.3 Deleting files</a></h2>You can delete files from Amazon S3 just knowing the bucket name and full path for it (just file name or path + file name)<p class="paragraph"/>It is damn simple, like the examples below<p class="paragraph"/>You'll first need to define the <strong class="bold">aws</strong> bean that is provided by the plugin:<p class="paragraph"/><div class="code"><pre>class MyController &#123;<p class="paragraph"/>    def aws<p class="paragraph"/>    def myAction = &#123;
        (...)
    &#125;
&#125;</pre></div><p class="paragraph"/>After that, you will use the <strong class="bold">aws</strong> bean and call the <strong class="bold">s3()</strong> method. This will return a helper for S3 Service. After that, you set the target bucket and then call the <strong class="bold">delete</strong> method.<p class="paragraph"/><h3>Deleting files stored on the root of some bucket (without path):</h3><p class="paragraph"/>To delete the "photo.jpg" file stored under "my-app-bucket-photos" bucket (http://my-app-bucket-photos.s3.amazonaws.com/photo.jpg)<p class="paragraph"/><div class="code"><pre>aws.s3().on(<span class="java&#45;quote">"my&#45;app&#45;bucket&#45;photos"</span>).delete(<span class="java&#45;quote">"photo.jpg"</span>)</pre></div><p class="paragraph"/><h3>Deleting files stored in some path of one bucket:</h3><p class="paragraph"/>To delete the "avatar.jpg" file stored under "my-app-bucket-avatars" bucket and path "/users/lucastex/" (http://my-app-bucket-avatars.s3.amazonaws.com/users/lucastex/avatar.jpg)<p class="paragraph"/><div class="code"><pre>aws.s3().on(<span class="java&#45;quote">"my&#45;app&#45;bucket&#45;avatars"</span>).delete(<span class="java&#45;quote">"avatar.jpg"</span>, <span class="java&#45;quote">"/users/lucastex/"</span>)</pre></div><h1><a name="3 Amazon Simple Email Service (AWS SES)">3 Amazon Simple Email Service (AWS SES)</a></h1>Amazon Simple E-mail Service (SES for now), it is a Sending E-mail Service provided by amazon, with a real low cost for users. The plugin interacts with it, so you can send e-mails using SES infrastructure without extra code in your app.<p class="paragraph"/>If you just want to send e-mails using your non-SES infrastructure, this plugin won't help you, I recommend you to use the great <strong class="bold">Grails Mail Plugin</strong> (<a href="http://grails.org/plugin/mail" target="blank">http://grails.org/plugin/mail</a>).<p class="paragraph"/>Unfortunately, SES does not provide a simple SMTP server address to connect and use, otherwise we could just configure the Grails Mail Plugin to use it. Instead of this, AWS provides a http web service for it.<p class="paragraph"/>But, if you really want to use Mail Plugin, you can configure AWS SES with a SMTP Bridge to connect to your SMTP server, but only if you're running Postfix or Sendmail locally. For doing this, check AWS SES Developer Guide.<p class="paragraph"/><blockquote class="warning">
You have to be subscribed to SES, if you are not yet, do it before using the plugin.
</blockquote><p class="paragraph"/>.h3 Interacting with SES<p class="paragraph"/>Grails AWS Plugin adds two types of interacting with AWS Simple Email Service.<h2><a name="3.1 SES Gant scripts">3.1 SES Gant scripts</a></h2>Introductory info on Gant Scripts for AWS Plugin is described in the beginning of this guide (section 1.4).<p class="paragraph"/><h2><a name="3.1.1 Operation VerifyEmail">3.1.1 Operation VerifyEmail</a></h2>To let AWS SES send e-mails using your e-mail as 'from' address, you have to authorize it.<p class="paragraph"/>To to so, you can run the script:<p class="paragraph"/><div class="code"><pre>grails aws&#45;ses&#45;verify&#45;email</pre></div><p class="paragraph"/>You'll be prompted about the e-mail address to verify. After that, SWS will send an confirmation e-mail to this address, you should click on the link in that e-mail to start sending emails using this from.<p class="paragraph"/>You will have to do it for all emails you want to use with SES.<h2><a name="3.1.2 Operation ListVerifiedEmails">3.1.2 Operation ListVerifiedEmails</a></h2>This will allow you to see all verified emails with amazon with the configured credentials.<p class="paragraph"/>To use:<p class="paragraph"/><div class="code"><pre>grails aws&#45;ses&#45;list&#45;verified&#45;emails</pre></div><h2><a name="3.1.3 Operation GetSendQuota">3.1.3 Operation GetSendQuota</a></h2>Retrieves for you the current quota for you. Will give you information on how much emails you can send per day, per second, and the number of e-mails you're allowed to send.<p class="paragraph"/><div class="code"><pre>grails aws&#45;ses&#45;get&#45;send&#45;quota</pre></div><h2><a name="3.1.4 Operation GetSendStatistics">3.1.4 Operation GetSendStatistics</a></h2> <em class="italic">(from aws docs)</em> <p class="paragraph"/>Returns the user's sending statistics (the amount of sent mails, bounced, spammed and etc). The output is a list of items, for the last two weeks of sending activity. Each item in the list contains statistics for a 15-minute interval.<p class="paragraph"/><div class="code"><pre>grails aws&#45;ses&#45;get&#45;send&#45;statistics</pre></div><h2><a name="3.1.5 Testing your verified email">3.1.5 Testing your verified email</a></h2><blockquote class="warning">
Attention: If you only subscribed to Amazon SES and still didn't get access for production using, you'll only be allowed to send e-mails 'from' AND 'to' emais that has been verified with amazon. So, you'll have to use the 'grails aws-ses-verify-email' for both sender and recipient adresses. After getting production access, this won't be needed.                
</blockquote><p class="paragraph"/>This script is a simple utility to test if amazon has verified your email correctly.<p class="paragraph"/>It will queue one test email message for SES. You'll be prompted for the FROM email address and the TO email address to send. Remember, you have to verify these emails first.<p class="paragraph"/><div class="code"><pre>grails aws&#45;ses&#45;send&#45;ping&#45;mail</pre></div><h2><a name="3.2 Sending mail from your application">3.2 Sending mail from your application</a></h2><blockquote class="warning">
Attention: If you only subscribed to Amazon SES and still didn't get access for production using, you'll only be allowed to send e-mails 'from' AND 'to' emais that has been verified with amazon. So, you'll have to use the 'grails aws-ses-verify-email' for both sender and recipient adresses. After getting production access, this won't be needed.                
</blockquote><p class="paragraph"/>Sending e-mails from your application is easy, and you can do it from your services or controllers just calling the <strong class="bold">sesMail</strong> closure that is injected on these artifacts.<p class="paragraph"/><div class="code"><pre>class SesTestController &#123;<p class="paragraph"/>    def sendPlainTextMail = &#123;<p class="paragraph"/>        def mailId = sesMail &#123;
            to <span class="java&#45;quote">"test&#45;email@gmail.com"</span>
            subject <span class="java&#45;quote">"test plain text mail"</span>
            body <span class="java&#45;quote">"sendPlainTextMail ($&#123;<span class="java&#45;keyword">new</span> Date().format('dd/MM/yyyy HH:mm')&#125;)"</span>
        &#125;<p class="paragraph"/>        render <span class="java&#45;quote">"E&#45;mail sent: $&#123;mailId&#125;"</span>
    &#125;
&#125;</pre></div><h2><a name="3.2.1 Configuring the SES options">3.2.1 Configuring the SES options</a></h2>The plugin provides these configurations for SES service.<p class="paragraph"/><h3>enabled</h3><p class="paragraph"/>The plugin is enabled by default on all environments, you can set 'enabled=false' on some environments to disable email sending. This is useful on testing environments where integration tests runs.<p class="paragraph"/><h3>catchall</h3><p class="paragraph"/>If you set the 'catch all' address, it will override any other address you set in 'to', 'cc' and 'bcc' properties. 
This is useful when you have acceptance tests or other environments/uses that you want your mails to be sent, but not to the usual addresses, but to one and only one address.<p class="paragraph"/>Any attemp to send emails with this property configured, will send e-mails to the address configured, with no 'cc' and 'bcc' addresses.<p class="paragraph"/><h3>from</h3><p class="paragraph"/>The default 'from' address to be used. You can override this parameter in every call to the plugin, setting the 'from' parameter. As said before, this address have to be verified with AWS (check Gant scripts section to see how to do it).<p class="paragraph"/><h3>Configuration example</h3><p class="paragraph"/>To configure it, you'll do the following inside the <strong class="bold">grails.plugin.aws</strong> section of your application Config.<p class="paragraph"/><div class="code"><pre>grails &#123;
   plugin &#123;
      aws &#123;<p class="paragraph"/>         ses &#123;
            enabled = <span class="java&#45;keyword">false</span>
            catchall = <span class="java&#45;quote">"allmailforme@gmail.com"</span>
            from = <span class="java&#45;quote">"my&#45;verified&#45;email@gmail.com"</span>
         &#125;<p class="paragraph"/>      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><h2><a name="3.2.2 Sending text emails">3.2.2 Sending text emails</a></h2>To send e-mails, just call the <strong class="bold">sesMail</strong> closure as seen before<p class="paragraph"/><div class="code"><pre>def mailId = sesMail &#123;
    from <span class="java&#45;quote">"origin@gmail.com"</span>
    to <span class="java&#45;quote">"test&#45;email@gmail.com"</span>
    subject <span class="java&#45;quote">"test plain text mail"</span>
    body <span class="java&#45;quote">"<span class="java&#45;keyword">this</span> is the e&#45;mail content, sent at: ($&#123;<span class="java&#45;keyword">new</span> Date().format('dd/MM/yyyy HH:mm')&#125;)"</span>
&#125;</pre></div><p class="paragraph"/>The <strong class="bold">sesMail</strong> returns an unique identifier for this e-mail at Amazon infrastructure, as this one:<p class="paragraph"/><div class="code"><pre>0000012dcde0ea1c&#45;d331d2ec&#45;3972&#45;4a6c&#45;825f&#45;fc980cde3352&#45;000000</pre></div><p class="paragraph"/>Amazon don't provide anything useful to do with this <strong class="bold">id</strong> yet, but I imagine that in a near future, you'll be able to retrieve if this email was delivered correctly, or if it was spammed or bounced. So, feel free to store it if you want to.<p class="paragraph"/><h3>Closure parameters</h3><p class="paragraph"/><h4>AWS Credentials</h4><p class="paragraph"/>As the S3 file upload support, you can override AWS credentials settings for sending mails. This is rare and unusual, but if you really need, do the same as in S3.<p class="paragraph"/><div class="code"><pre>credentials <span class="java&#45;quote">"<span class="java&#45;keyword">new</span>&#45;access&#45;key"</span>, <span class="java&#45;quote">"<span class="java&#45;keyword">new</span>&#45;secret&#45;key"</span></pre></div><p class="paragraph"/>Just remember, if this new AWS credentials belong to another AWS account, this account will have to be subscribed to SES service and have verified e-mails to send.<p class="paragraph"/><h4>Defining the sender</h4><p class="paragraph"/>As seen in the other topic, you can set this default address in the application Config, but if you want to explicitly set the address in each email you send, just override the <strong class="bold">from</strong> method:<p class="paragraph"/><div class="code"><pre>from <span class="java&#45;quote">"my&#45;other&#45;email@gmail.com"</span></pre></div><p class="paragraph"/><h4>Defining recipient e-mails</h4><p class="paragraph"/><h5>To</h5><p class="paragraph"/>To set the recipient e-mail, use the <strong class="bold">to</strong> method.<p class="paragraph"/><div class="code"><pre>to <span class="java&#45;quote">"user@myapp.com"</span></pre></div><p class="paragraph"/>You can send to multiple addresses doing this:<p class="paragraph"/><div class="code"><pre>to <span class="java&#45;quote">"user<code>myapp.com"</span>, <span class="java&#45;quote">"user2</code>myapp.com"</span>, <span class="java&#45;quote">"user3@myapp.com"</span></pre></div><p class="paragraph"/><h5>CC and BCC</h5><p class="paragraph"/>To set CC and BCC addresses, you can do the same as <strong class="bold">to</strong> addresses:<p class="paragraph"/><div class="code"><pre>cc <span class="java&#45;quote">"copied@myapp.com"</span></pre></div><p class="paragraph"/><div class="code"><pre>bcc <span class="java&#45;quote">"you&#45;dont&#45;know&#45;me&#64;myapp.com"</span></pre></div><p class="paragraph"/>And again, for multiple addresses:<p class="paragraph"/><div class="code"><pre>ccc <span class="java&#45;quote">"user1&#64;myapp.com"</span>, <span class="java&#45;quote">"user2&#64;myapp.com"</span>, <span class="java&#45;quote">"user3&#64;myapp.com"</span></pre></div><p class="paragraph"/><div class="code"><pre>bcc <span class="java&#45;quote">"user4&#64;myapp.com"</span>, <span class="java&#45;quote">"user5&#64;myapp.com"</span>, <span class="java&#45;quote">"user6&#64;myapp.com"</span></pre></div><p class="paragraph"/><h4>Setting the e-mail subject</h4><p class="paragraph"/>To set the subject, following other parameters convention:<p class="paragraph"/><div class="code"><pre>subject <span class="java&#45;quote">"Testing the AWS Plugin"</span></pre></div><p class="paragraph"/><h4>E-mail body</h4><p class="paragraph"/>And finally, the e-mail body can be set with:<p class="paragraph"/><div class="code"><pre>body <span class="java&#45;quote">"This is the text user will receive in the e&#45;mail body"</span></pre></div><h2><a name="3.2.3 Sending HTML emails">3.2.3 Sending HTML emails</a></h2>You can send html emails the same way you'd do with text e-mails, just instead of calling the <strong class="bold">body</strong> method, you have to pass the content to the <strong class="bold">html</strong> method:<p class="paragraph"/><div class="code"><pre>sesMail &#123;
   to <span class="java&#45;quote">"email@gmailcom"</span>
   subject <span class="java&#45;quote">"testing html emails"</span>
   html <span class="java&#45;quote">"&#60;html&#62;&#60;body&#62;&#60;h3&#62;HTML email&#60;/h3&#62;&#60;strong&#62;Strong text&#60;/strong&#62;&#60;/body&#62;&#60;/html&#62;"</span>
&#125;</pre></div><p class="paragraph"/><h3>Using GSP templates to generate html emails</h3><p class="paragraph"/>I bet you don't want to write all the HTML in your closure, so, you can design your e-mail in a grails template and use it to define the email content:<p class="paragraph"/><div class="code"><pre>sesMail &#123;
   to <span class="java&#45;quote">"email@gmailcom"</span>
   subject <span class="java&#45;quote">"testing html emails"</span>
   html g.render(template: <span class="java&#45;quote">"/email&#45;templates/template"</span>, model: &#91;name: <span class="java&#45;quote">"Lucas"</span>, now: <span class="java&#45;keyword">new</span> Date()&#93;)
&#125;</pre></div><p class="paragraph"/>This will render the <strong class="bold">/email-templates/_template.gsp</strong> passing the model map to the rendering engine. For example, let's imagine this file has the following content:<p class="paragraph"/><div class="code"><pre>&#60;html&#62;
   &#60;body&#62;
      &#60;h2&#62;Testing e&#45;mail templates&#60;/h2&#62;
      &#60;ul&#62;
         &#60;li&#62;Name: $&#123;name&#125;&#60;/li&#62;
         &#60;li&#62;Now: $&#123;now.format('dd/MM/yyyy HH:mm')&#125;&#60;/li&#62;
      &#60;/ul&#62;
   &#60;/body&#62;
&#60;/html&#62;</pre></div><p class="paragraph"/>This will send the html e-mail with the content below rendered:<p class="paragraph"/><div class="code"><pre>&#60;html&#62;
   &#60;body&#62;
      &#60;h2&#62;Testing e&#45;mail templates&#60;/h2&#62;
      &#60;ul&#62;
         &#60;li&#62;Name: Lucas&#60;/li&#62;
         &#60;li&#62;Now: 28/01/2010 18:02&#60;/li&#62;
      &#60;/ul&#62;
   &#60;/body&#62;
&#60;/html&#62;</pre></div><p class="paragraph"/><blockquote class="warning">
You can use both methods <strong class="bold">html</strong> and <strong class="bold">body</strong> to send e-mails with both content in it. This is usually the best approach, since user may not allowed his email client to render html emails. So, it is up to you.
</blockquote><h1><a name="4 FAQ">4 FAQ</a></h1><strong class="bold">Q) Why not use amazon-s3 plugin?</strong><p class="paragraph"/>A) Because it is not under massive development anymore, because it depends on quartz plugin, and because I found some itchy bugs on it that really annoys me on my other project using it.<p class="paragraph"/>
<strong class="bold">Q) Why you don’t submit a patch to it?</strong><p class="paragraph"/>A) Because it is not under massive development anymore (again), and because the idea on this grails-aws plugin, as I said before, is to offer an easier way to use AWS service, and not only S3.<p class="paragraph"/>
<strong class="bold">Q) I have some aws code that I'm using here, can I attach it on this plugin and send a pull request?</strong><p class="paragraph"/>A) For sure, I'd be thankful if you are willing to do so, but remember the main reason we're developing this plugin, to provide <strong class="bold">EASY</strong> access to AWS functionalities.<p class="paragraph"/><strong class="bold">Q) Can I use this plugin to send e-mails using my current SMTP infrastructure?</strong><p class="paragraph"/>A) Unfortunately, SES does not provide a simple SMTP server address to connect and use, otherwise we could just configure the Grails Mail Plugin to use it. Instead of this, AWS provides a http web service for it.<p class="paragraph"/><strong class="bold">Q) Can I use the Grails Mail plugin to connect to Amazon SES Email service?</strong><p class="paragraph"/>A) As described above, SES does not offer you a SMTP address, but If you really want to use Mail Plugin, you can configure AWS SES with a SMTP Bridge to connect to your SMTP server, but only if you're running Postfix or Sendmail locally. There is a great post that shows how to do this: <a href="http://netwiser.blogspot.com/2011/02/setup-amazon-ses-to-relay-email-by.html" target="blank">http://netwiser.blogspot.com/2011/02/setup-amazon-ses-to-relay-email-by.html</a>
<h1><a name="5 Roadmap">5 Roadmap</a></h1><h3>Amazon Cloudfront</h3>
<ul class="star">
<li>Cloudfront Distribution creation</li>
</ul><p class="paragraph"/><h3>Amazon SNS</h3>
<ul class="star">
<li>Basic integration with Amazon SNS</li>
</ul><p class="paragraph"/><h3>Amazon SQS</h3>
<ul class="star">
<li>Basic integration with Amazon SQS with Typica (http://code.google.com/p/typica/wiki/TypicaSampleCode)</li>
</ul><p class="paragraph"/><h3>Amazon Beanstalk</h3>
<ul class="star">
<li>Scripts for allowing deploy directly to Amazon Beanstalk infrastructure</li>
</ul><p class="paragraph"/><h1><a name="6 Changelog">6 Changelog</a></h1><ul class="star">
<li><strong class="bold">1.1.7.2 release</strong> Mar 02 2011</li>
<ul class="star">
<li>Release notes: <a href="http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11450&version=17211" target="blank">http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11450&#38;version=17211</a></li>
</ul>
<li><strong class="bold">1.1.7.1 release</strong> Feb 25 2011</li>
<ul class="star">
<li>Release notes: <a href="http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11450&version=17188" target="blank">http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11450&#38;version=17188</a></li>
</ul>
<li><strong class="bold">1.1.5.1 release</strong> Feb 08 2011</li>
<ul class="star">
<li>Release notes: <a href="http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11450&version=17127" target="blank">http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11450&#38;version=17127</a></li>
</ul>
<li><strong class="bold">1.1.4.1 release</strong> Jan 30 2011</li>
<ul class="star">
<li>Release notes: <a href="http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11450&version=17096" target="blank">http://jira.codehaus.org/secure/ReleaseNote.jspa?projectId=11450&#38;version=17096</a></li>
</ul>
<li><strong class="bold">0.2 release</strong> Jan 18 2011</li>
<ul class="star">
<li>issue 6 Define bucket region when creating buckets that does not exists</li>
<li>issue 5 Use groovy doc to plugins documentation instead github readme</li>
<li>issue 4 Use encrypted credentials</li>
<li>issue 3 Create buckets before upload if they does not exists</li>
<li>issue 2 Ability to set path (virtual folder) to files</li>
<li>issue 1 Set file content-type before upload</li>
</ul>
<li><strong class="bold">0.1 release</strong> Jan 13 2011</li>
<ul class="star">
<li>Upload to AWS S3</li>
<li>Plugin configuration in Config.groovy</li>
</ul></ul><p class="paragraph"/><h1><a name="7 Contributions and reporting bugs">7 Contributions and reporting bugs</a></h1>If you want to contribute, just fork the repo, implement what you want and send me a pull request.<p class="paragraph"/>Just remember, the focus on this plugin it is not the complexity of features, but the ease on using it! :)<p class="paragraph"/><h2>Thanks to contributors</h2>
<ul class="star">
<li>Kim A. Betti - @kimbetti</li>
<li>Sankara Rameswaran - @sankara</li>
</ul><p class="paragraph"/><h2>Found a bug? Report it for us</h2><p class="paragraph"/>Grails AWS Plugin is using the Codehaus JIRA for handling issues.<p class="paragraph"/>If you found some bug or want to propose a new functionality, or anything related, send your questions on the Grails User Mailing List so people can help you out, or even fill a JIRA Issue here: <a href="http://jira.codehaus.org/browse/GRAILSPLUGINS" target="blank">http://jira.codehaus.org/browse/GRAILSPLUGINS</a> under the component <strong class="bold">Grails-AWS</strong><h1><a name="8 Contact">8 Contact</a></h1><ul class="star">
<li>Lucas Teixeira</li>
<li>lucastex at gmail dot com</li>
<li>twitter @lucastex</li>
</ul><p class="paragraph"/>
        </div>
        <div id="footer">
             
        </div>
    </body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2.4 Accessing files 1.2.12.4</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/1%20Introduction%20to%20Grails%20AWS%20Plugin.html"><strong>1</strong><span>Introduction to Grails AWS Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/2%20Amazon%20Simple%20Storage%20Service%20(AWS%20S3).html"><strong>2</strong><span>Amazon Simple Storage Service (AWS S3)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/3%20Amazon%20Simple%20Email%20Service%20(AWS%20SES).html"><strong>3</strong><span>Amazon Simple Email Service (AWS SES)</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Amazon Web Services (AWS) grails plugin provides easy access to simpler functions of AWS</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/1%20Introduction%20to%20Grails%20AWS%20Plugin.html">&lt;&lt; <strong>1</strong><span>Introduction to Grails AWS Plugin</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/3%20Amazon%20Simple%20Email%20Service%20(AWS%20SES).html"><strong>3</strong><span>Amazon Simple Email Service (AWS SES)</span> >></a></div>
                


                <div class="project">
                    <h1>2.4 Accessing files - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Lucas Teixeira, Jay Prall</p>

                    <p><strong>Version:</strong> 1.2.12.4</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#2.4.1%20Accessing%20public%20files"><strong>2.1</strong><span>Accessing public files</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#2.4.2%20Accessing%20private%20files"><strong>2.2</strong><span>Accessing private files</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#2.4.3%20Creating%20public%20URLs%20for%20private%20files"><strong>2.3</strong><span>Creating public URLs for private files</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#2.4.4%20Creating%20torrent%20for%20S3%20hosted%20files"><strong>2.4</strong><span>Creating torrent for S3 hosted files</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#2.4.5%20Accessing%20only%20file%20metadata"><strong>2.5</strong><span>Accessing only file metadata</span></a>
                    </div>
                    
                </div>
                

                

<h2 id="2.4 Accessing files">2.4 Accessing files</h2>
If you are uploading some document to S3, you'll probably need to store information on how to get that file again later.<p class="paragraph"/>The <strong class="bold">s3upload</strong> operation returns an instance of <strong class="bold">grails.plugin.aws.s3.S3File</strong>. As this plugin uses jets3t (<a href="http://jets3t.s3.amazonaws.com/index.html" target="blank">http://jets3t.s3.amazonaws.com/index.html</a>) to handle file upload, the S3File is just a wrapper for a <strong class="bold">delegated</strong> jets3t S3Object instance as you can see below:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> grails.plugin.aws.s3<p class="paragraph"/><span class="java&#45;keyword">import</span> org.jets3t.service.model.S3Object<p class="paragraph"/>class S3File &#123;<p class="paragraph"/>    @Delegate S3Object source<p class="paragraph"/>    S3File(S3Object _source) &#123;
        source = _source
    &#125;    
&#125;</pre></div><p class="paragraph"/>So, you can call any S3Object method on S3File instance. S3Object API is available here: <a href="http://jets3t.s3.amazonaws.com/api/org/jets3t/service/model/S3Object.html" target="blank">http://jets3t.s3.amazonaws.com/api/org/jets3t/service/model/S3Object.html</a>, for example, to retrieve the ETag hash for the S3File uploaded you would just call:<p class="paragraph"/><div class="code"><pre>def s3file = &#8230; //upload the file
def etag = s3file.getETag()</pre></div><p class="paragraph"/>The <strong class="bold">S3File</strong> object returned will give all information you'll need. Now, depends on what information you want to store. Follow S3Object docs (link above) and get whatever you want.


<h2 id="2.4.1 Accessing public files">2.4.1 Accessing public files</h2>
You can always generate the URL to access your files manually. Specially if you're using your own CNAME for it or if you're using cloudfront in front of S3.
But, if you still need some easy and tricky way to generate it, you can do the following:<p class="paragraph"/><div class="code"><pre>def url = aws.s3().on(<span class="java&#45;quote">"my&#45;first&#45;bucket"</span>).url(<span class="java&#45;quote">"photo.jpg"</span>)</pre></div><p class="paragraph"/>This will return an url like this: <strong class="bold">http://my-first-bucket.s3.amazonaws.com/photo.jpg</strong>. And if you're using paths for your file:<p class="paragraph"/><div class="code"><pre>def url = aws.s3().on(<span class="java&#45;quote">"my&#45;first&#45;bucket"</span>).url(<span class="java&#45;quote">"photo.jpg"</span>, <span class="java&#45;quote">"userphotos"</span>)</pre></div><p class="paragraph"/>That will gives you: <strong class="bold">http://my-first-bucket.s3.amazonaws.com/userphotos/photo.jpg</strong>


<h2 id="2.4.2 Accessing private files">2.4.2 Accessing private files</h2>
In some cases, you may need to access the private file directly (and not using the temporary public URL). For example, if you need to directly stream the file to the action's respose, you can do the following:<p class="paragraph"/><div class="code"><pre>def downloadFile = &#123;<p class="paragraph"/>    def bucket = params.bucket
    def path   = params.path
    def name   = params.name<p class="paragraph"/>    def fileToDownload = aws.s3().on(bucket).get(name, path)
    response.setContentType(<span class="java&#45;quote">"image/jpeg"</span>) //the file content type you're serving
    response.setHeader(<span class="java&#45;quote">"Content&#45;disposition"</span>, <span class="java&#45;quote">"inline; filename='$&#123;name&#125;'"</span>)
    response.outputStream &#60;&#60; fileToDownload.dataInputStream
&#125;</pre></div><p class="paragraph"/>This way, your application will download the file, and then serve to user's response outputstream.


<h2 id="2.4.3 Creating public URLs for private files">2.4.3 Creating public URLs for private files</h2>
When you upload a file to S3 with a "private" acl, means that the file won't be accessed directly using the URL, but only with your amazon credentials.<p class="paragraph"/>For example:<p class="paragraph"/><div class="code"><pre>def s3file = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"test.txt"</span>).s3upload &#123;
   bucket <span class="java&#45;quote">"secret&#45;files"</span>
   acl <span class="java&#45;quote">"<span class="java&#45;keyword">private</span>"</span>
&#125;</pre></div><p class="paragraph"/>This will make the file above (http://secret-files.s3.amazonaws.com/test.txt) inaccessible using its URL. If you need to allow someone to get the file in a short period of time, you can ask the plugin to generate a public URL for it. The object will remain private, but you can use the returned URL to access the file in a short period of time. For example:<p class="paragraph"/><div class="code"><pre>def s3file = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"test.txt"</span>).s3upload &#123;
   bucket <span class="java&#45;quote">"secret&#45;files"</span>
   acl <span class="java&#45;quote">"<span class="java&#45;keyword">private</span>"</span>
&#125;<p class="paragraph"/>def publicUrl = aws.s3().on(<span class="java&#45;quote">"secret&#45;files"</span>).publicUrlFor(1.hour, <span class="java&#45;quote">"test.txt"</span>)</pre></div><p class="paragraph"/>So, the value on the <strong class="bold">publicUrl</strong> is the URL for accessing the file. In this case, the URL will be valid for <strong class="bold">1 hour</strong>. Every requests on it will return the uploaded object. After one hour, next requests on it will return an error: "Access Denied for Object".<p class="paragraph"/><h3>Defining when public URL will expire</h3><p class="paragraph"/>You can set the expires date for the public URL, passing an argument to <strong class="bold">publicUrlFor</strong> method.<p class="paragraph"/><div class="code"><pre>(...).publicUrlFor(3.hours,  <span class="java&#45;quote">"test.txt"</span>) //will be available <span class="java&#45;keyword">for</span> 3 hours
(...).publicUrlFor(10.years, <span class="java&#45;quote">"test.txt"</span>) //available <span class="java&#45;keyword">for</span> 10 years
(...).publicUrlFor(1.second, <span class="java&#45;quote">"test.txt"</span>) //you won't get <span class="java&#45;keyword">this</span> one on time</pre></div><p class="paragraph"/>You can any of these variations:<p class="paragraph"/><div class="code"><pre>1.second or 2.seconds 
1.minute or 2.minutes
1.hour or 2.hours
1.day or 2.days
1.month or 2.months
1.year or 2.years</pre></div><p class="paragraph"/>This properties are injected on Integer class, so, enjoy the magic. 


<h2 id="2.4.4 Creating torrent for S3 hosted files">2.4.4 Creating torrent for S3 hosted files</h2>
It is possible to generate torrent URLs for S3 hosted files with the plugin.<p class="paragraph"/>After uploading some file, just call the <strong class="bold">torrent(...)</strong> method on the s3 helper this way.<p class="paragraph"/><div class="code"><pre>def s3file = <span class="java&#45;keyword">new</span> File(<span class="java&#45;quote">"test.txt"</span>).s3upload &#123;
   bucket <span class="java&#45;quote">"secret&#45;files"</span>
   acl <span class="java&#45;quote">"<span class="java&#45;keyword">private</span>"</span>
&#125;<p class="paragraph"/>def torrentUrl = aws.s3().on(<span class="java&#45;quote">"secret&#45;files"</span>).torrent(<span class="java&#45;quote">"test.txt"</span>)</pre></div><p class="paragraph"/>From the AWS docs:<p class="paragraph"/> <em class="italic"><strong class="bold">There is no extra charge for use of BitTorrent with S3</strong>. Data transfer via the BitTorrent protocol is metered at the same rate as client/server delivery. To be precise, whenever a downloading BitTorrent client requests a “piece” of an object from the S3 “seeder”, charges accrue just as if an anonymous request for that piece had been made using the REST or SOAP protocol. These charges will appear on your S3 bill and usage reports in the same way. <strong class="bold">The difference is that if a lot of clients are requesting the same object simultaneously via BitTorrent, then the amount of data S3 must serve to satisfy those clients will be lower than with client/server delivery</strong>. This is because the BitTorrent clients are simultaneously uploading and downloading amongst themselves. The data transfer savings achieved from use of BitTorrent can vary widely depending on how popular your object is. Less popular objects require heavier use of the “seeder” to serve clients, and thus the difference between BitTorrent distribution costs and client/server distribution costs may be small for such objects. In particular, if only one client is ever downloading a particular object at a time, the cost of BitTorrent delivery will be the same as direct download.</em> 


<h2 id="2.4.5 Accessing only file metadata">2.4.5 Accessing only file metadata</h2>
If you just want to know some details about an object and you don't need its contents, it's faster to use the getDetails method. This returns only the object's details, also known as its 'HEAD'. Head information includes the object's size, date, and other metadata associated with it such as the Content Type.<p class="paragraph"/><div class="code"><pre>def downloadFileMetadata = &#123;<p class="paragraph"/>    def bucket = params.bucket
    def path   = params.path
    def name   = params.name<p class="paragraph"/>    def fileDetails = aws.s3().on(bucket).getDetails(name, path)<p class="paragraph"/>    render &#91;md5:fileDetails.getMd5HashAsBase64(),
            length:fileDetails.getContentLength(),
            type:fileDetails.getContentType()&#93; as JSON
&#125;</pre></div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/1%20Introduction%20to%20Grails%20AWS%20Plugin.html">&lt;&lt; <strong>1</strong><span>Introduction to Grails AWS Plugin</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/3%20Amazon%20Simple%20Email%20Service%20(AWS%20SES).html"><strong>3</strong><span>Amazon Simple Email Service (AWS SES)</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">SES</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/SES/aws-ses-get-send-quota.html">aws-ses-get-send-quota</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/SES/aws-ses-get-send-statistics.html">aws-ses-get-send-statistics</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/SES/aws-ses-list-verified-emails.html">aws-ses-list-verified-emails</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/SES/aws-ses-send-ping-mail.html">aws-ses-send-ping-mail</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/SES/aws-ses-verify-email.html">aws-ses-verify-email</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
